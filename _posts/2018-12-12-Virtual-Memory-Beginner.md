---
layout: post
title:  "Virtual Memory for beginer"
date:   2018-12-12 08:00
categories: study
---

# 가상 메모리 왜 알아야 할까

- 나의 경우
    - c 를 공부할 때 malloc 을 하면 heap 영역에 memory 를 할당한다고 배웠는데 heap 이 뭔지 궁금해 졌을 때
    - 메모리 누수가 난 프로그램을 봐서 왜 메모리 누수가 나나 궁금해 졌을 때
    - 시스템 프로그래밍과목에서 가상 메모리가 살짝 시험에 나오기 때문
    - C , C++ 처럼 메모리 관리가 필요한 언어에서 왜 필요한가 궁금할 때

# 어디까지 정리할까

- 가상메모리에 모든 걸 공부해서 정리하겠다가 아닌 복학하고 운영체제 수업에 가서야 가상메모리에 대해 자세히 배울거 같으니까 우선은 아주 간단하게 내가 이해한 것만 정리하겠다.

# 가상 메모리란??

- 내 생각
    - 한 프로세스가 실행될 때 사용하는 메모리를 관리하는 방법을 추상화한 개념.
    - 실제 메모리 관리에 대해 세부적으로 들어가면 더욱 더 복잡하고 어렵다. 그렇기 때문에 세부적인 부분은 운영체제에서 알아서 해줄것이고 우리는 가상 메모리 개념대로 메모리를 사용 or 생각하면 된다.

# 가상 메모리 

- 가상 메모리를 쓰는 이유, 왜 쓰는 걸까
    - 한정된 물리 메모리의 한계를 극복하고자 main memory 만 쓰는 것인 아닌 디스크와 같은 느린 저장장치를 활용하기 위해서
    - 램만 가지고는 부족하니까 느리지만 하드의 일부분을 램처럼 쓰기 위해서.

- 가상 메모리
    - 모든 프로세스는 자신만의 가상 주소 공간을 가지고 있고 프로세스가 실행되는 동안 그 공간을 활용한다.
    - 32bit 프로그램은 4 GB, 64bit 프로그램은 8 GB 크기의 가상 주소 공간을 갖는다 = 한 프로그램은 최대 4GB or 8GB 까지 메모리를 사용할 수 있다. 

- 가상 메모리 내부 구조
    - 간단히 
        - <img src="/resource/img/virtualmemory_beginer(1).png" width="800px" height="200px">
        - 한 프로세스가 실행되면 한 프로세스마다 00000000 ~ ffffffff 의 주소가 할당 된다.
        - Stack : 함수 안 **지역 변수** 들이 저장된다. 크기가 변한다. 아래로 커진다. ( 이미 변수의 크기가 정해져 있을 때 )
        - Heap : malloc 으로 정해지지 않은 크기의 메모리를 할당해야 할 때 이 곳에 할당 된다. ( 런타임에 그 크기가 정해질 때 ), free 해주지 않으면 heap 영역이 가득차서 더 이상 할당할 곳이 없어지게 되고 메모리 누수가 발생한다.
        - Code/Data : 실행될 기계어 코드들 그리고 전역 변수들이 저장되어 있다. 없어지지 않기 때문에 크기가 변하지 않는다. 
    
    - 좀 자세히
        - <img src="/resource/img/virtualmemory_beginer(2).jpg" width="800px" height="200px">
        - kernel virtual memory
        - user stack
        - memory-mapped region for shared libraries
        - run-time heap
        - read/write data
        - read-only code and data

# 의문점

- 모든 프로세스가 FFFFFFFF byte(4GB) 를 할당 받는 것인가?? 
    - yes
- 그러면 어떻게 여러 프로세스를 돌릴 수 있는 것인가?? 
- FFFFFFFF 가 의미하는 것은?? 
    - 주소의 범위 ( 00000000 ~ FFFFFFFF) 
- 프로세스마다 0~FFFFFFFF 까지 주소가 할당되는데 다른 프로세스에서 같은 주소값이 할당이 될 수 있나?? 
    - yes

# 참조

- http://egloos.zum.com/sweeper/v/2988689